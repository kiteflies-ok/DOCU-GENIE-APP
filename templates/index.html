<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Engine | Repurpose Video</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        /* --- CORE VISUALS --- */
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #0d0d12;
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 1000px;
        }

        /* --- LIQUID BACKGROUND --- */
        .ambient-light {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100vw;
            height: 100vh;
            background:
                radial-gradient(circle at 10% 20%, rgba(99, 102, 241, 0.2), transparent 40%),
                radial-gradient(circle at 80% 80%, rgba(236, 72, 153, 0.15), transparent 40%);
            filter: blur(80px);
            z-index: -2;
        }

        /* --- THE GLASS CARD --- */
        .glass-panel {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* --- UPLOAD ZONE --- */
        .upload-zone {
            background: rgba(255, 255, 255, 0.02);
            border: 2px dashed rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .upload-zone:hover {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.05);
        }

        /* --- INPUTS --- */
        .glass-select {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }

        .glass-select option {
            background: #1a1a2e;
        }

        /* --- BUTTON --- */
        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            transition: transform 0.2s;
        }

        .btn-primary:hover {
            transform: scale(1.02);
        }

        /* --- CHAT HUD --- */
        .chat-hud {
            background: rgba(20, 20, 25, 0.95);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>

<body>

    <div class="ambient-light"></div>

    <div class="relative w-full max-w-7xl p-4 flex flex-col md:flex-row items-start justify-center gap-6">

        <!-- LEFT: MAIN CARD -->
        <div class="glass-panel w-full max-w-xl rounded-3xl p-8 md:p-10 relative overflow-hidden shrink-0">

            <div class="mb-8 text-center">
                <div
                    class="inline-block px-3 py-1 mb-4 rounded-full bg-indigo-500/10 border border-indigo-500/20 text-xs tracking-widest text-indigo-300 uppercase">
                    New Engine v1.0
                </div>
                <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight mb-2">
                    DOCU - <span
                        class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400">GENIE</span>
                </h1>
                <p class="text-white/40 font-light">
                    Transform one video into a summary, script, and social pack.
                </p>
            </div>

            <form id="uploadForm" class="space-y-6">

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Style Selector -->
                    <div>
                        <label class="block text-xs uppercase text-white/40 mb-2 tracking-wider">Tone & Style</label>
                        <select name="style" id="style-select"
                            class="glass-select w-full px-4 py-3 rounded-xl focus:outline-none focus:border-indigo-500">
                            <option value="Professional (Corporate)">ðŸ‘” Professional</option>
                            <option value="Viral/Hype (High Energy)">ðŸ”¥ Viral/Hype</option>
                            <option value="Educational (Academic)">ðŸŽ“ Educational</option>
                            <option value="Witty (Fun/Casual)">ðŸ˜‰ Witty</option>
                        </select>
                    </div>

                    <!-- Visual Cues Selector -->
                    <div>
                        <label class="block text-xs uppercase text-white/40 mb-2 tracking-wider">Visual Cues</label>
                        <select name="screenshot_count" id="screenshot-select"
                            class="glass-select w-full px-4 py-3 rounded-xl focus:outline-none focus:border-indigo-500">
                            <option value="3" selected>ðŸ“¸ 3 Frames</option>
                            <option value="2">2 Frames</option>
                            <option value="5">5 Frames</option>
                            <option value="7">7 Frames</option>
                            <option value="9">9 Frames</option>
                            <option value="11">11 Frames</option>
                        </select>
                    </div>
                </div>

                <!-- Hidden Language Input (Force English) -->
                <input type="hidden" name="language" value="English">

                <!-- Drop Zone -->
                <div id="drop-zone" class="upload-zone rounded-2xl p-8 cursor-pointer text-center relative">
                    <input type="file" id="video-input" name="video" class="hidden" accept="video/*" required>

                    <div id="upload-prompt">
                        <div
                            class="w-14 h-14 mx-auto mb-3 rounded-full bg-indigo-500/10 flex items-center justify-center">
                            <svg class="w-6 h-6 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12">
                                </path>
                            </svg>
                        </div>
                        <p class="text-indigo-200 font-medium">Click to upload video</p>
                        <p class="text-xs text-white/30 mt-1">MP4, MOV, AVI (Max 1GB)</p>
                    </div>

                    <div id="file-selected" class="hidden">
                        <p id="filename" class="text-white font-medium truncate"></p>
                        <p class="text-xs text-green-400 mt-1">Ready to process</p>
                    </div>
                </div>

                <button type="submit" id="submit-btn"
                    class="w-full btn-primary py-4 rounded-xl text-white font-bold text-lg tracking-wide shadow-lg shadow-indigo-500/20">
                    GENERATE ASSETS
                </button>
            </form>

            <div id="loading" class="hidden py-12 text-center">
                <div
                    class="inline-block w-8 h-8 border-4 border-white/10 border-t-indigo-500 rounded-full animate-spin mb-4">
                </div>
                <p class="text-indigo-300 animate-pulse">Analyzing content matrix...</p>
                <p class="text-white/20 text-xs mt-2">Extracting script â€¢ Designing socials â€¢ Formatting PDF</p>
            </div>

            <div id="success" class="hidden py-8 text-center">
                <div class="text-6xl mb-4">ðŸš€</div>
                <h3 class="text-2xl font-bold text-white mb-2">Content Pack Ready!</h3>
                <div class="flex flex-col gap-3 mt-6">
                    <a id="download-link" href="#"
                        class="w-full bg-white text-black font-bold py-3 rounded-xl hover:bg-gray-200 transition-colors flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        Download PDF Report
                    </a>
                    <a id="download-transcript" href="#"
                        class="w-full bg-indigo-900/50 text-indigo-200 font-bold py-3 rounded-xl hover:bg-indigo-900/80 transition-colors flex items-center justify-center gap-2 border border-indigo-500/30">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                            </path>
                        </svg>
                        Download Script (TXT)
                    </a>
                    <button id="show-chat-btn"
                        class="w-full bg-indigo-600 text-white font-bold py-3 rounded-xl hover:bg-indigo-700 transition-colors">
                        Refine with AI Assistant
                    </button>
                </div>
            </div>

            <div id="error" class="hidden mt-4 p-4 bg-red-500/10 border border-red-500/20 rounded-xl text-center">
                <p id="error-msg" class="text-red-300 text-sm"></p>
            </div>

        </div>

        <!-- RIGHT: CHAT INTERFACE (Hidden initially) -->
        <div id="chat-section"
            class="hidden w-full max-w-md h-[600px] glass-panel rounded-3xl flex flex-col relative shrink-0">
            <!-- Header -->
            <div class="p-6 border-b border-white/10 flex justify-between items-center">
                <div>
                    <h3 class="font-bold text-white">Content Assistant</h3>
                    <p class="text-xs text-white/40">Powered by Qwen-72B</p>
                </div>
                <button id="close-chat" class="text-white/30 hover:text-white">âœ•</button>
            </div>

            <!-- Messages -->
            <div id="chat-messages" class="flex-1 overflow-y-auto p-6 space-y-4">
                <div class="bg-indigo-500/10 p-4 rounded-2xl rounded-tl-none border border-indigo-500/20">
                    <p class="text-sm text-indigo-100">I've verified your content pack. What would you like to tweak? I
                        can rewrite tweets, shorten the script, or change the tone.</p>
                </div>
            </div>

            <!-- Input -->
            <div class="p-4 border-t border-white/10">
                <div class="relative">
                    <input type="text" id="chat-input"
                        class="w-full bg-black/30 border border-white/10 rounded-xl pl-4 pr-12 py-3 text-sm focus:outline-none focus:border-indigo-500 text-white placeholder-white/30"
                        placeholder="e.g. 'Make the LinkedIn post more punchy'">
                    <button id="send-btn"
                        class="absolute right-2 top-2 p-1.5 bg-indigo-600 rounded-lg hover:bg-indigo-500 transition-colors">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        let generatedContent = '';

        // UI References
        const dropZone = document.getElementById('drop-zone');
        const videoInput = document.getElementById('video-input');
        const fileSelected = document.getElementById('file-selected');
        const uploadPrompt = document.getElementById('upload-prompt');
        const filenameLabel = document.getElementById('filename');
        const form = document.getElementById('uploadForm');
        const loading = document.getElementById('loading');
        const success = document.getElementById('success');
        const errorDiv = document.getElementById('error');
        const downloadLink = document.getElementById('download-link');

        // Chat UI
        const chatSection = document.getElementById('chat-section');
        const showChatBtn = document.getElementById('show-chat-btn');
        const closeChatBtn = document.getElementById('close-chat');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const chatMessages = document.getElementById('chat-messages');

        // Drag & Drop
        dropZone.addEventListener('click', () => videoInput.click());
        videoInput.addEventListener('change', handleFile);
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.style.borderColor = '#6366f1'; });
        dropZone.addEventListener('dragleave', (e) => { e.preventDefault(); dropZone.style.borderColor = ''; });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.style.borderColor = '';
            if (e.dataTransfer.files.length) {
                videoInput.files = e.dataTransfer.files;
                handleFile();
            }
        });

        function handleFile() {
            if (videoInput.files.length) {
                uploadPrompt.classList.add('hidden');
                fileSelected.classList.remove('hidden');
                filenameLabel.textContent = videoInput.files[0].name;
            }
        }

        // Upload
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!videoInput.files.length) return;

            // State: Loading
            form.classList.add('hidden');
            loading.classList.remove('hidden');
            errorDiv.classList.add('hidden');
            chatSection.classList.add('hidden');

            const formData = new FormData(form);

            try {
                const res = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                const data = await res.json();

                if (!res.ok) throw new Error(data.error || 'Upload failed');

                // State: Success
                loading.classList.add('hidden');
                success.classList.remove('hidden');
                downloadLink.href = data.download_url;

                // Add Transcript Link
                const transcriptBtn = document.getElementById('download-transcript');
                if (data.transcript_url) {
                    transcriptBtn.href = data.transcript_url;
                    transcriptBtn.classList.remove('hidden');
                } else {
                    transcriptBtn.classList.add('hidden');
                }

                // Store context for chat
                generatedContent = data.transcript_text;

            } catch (err) {
                loading.classList.add('hidden');
                form.classList.remove('hidden');
                errorDiv.classList.remove('hidden');
                document.getElementById('error-msg').textContent = err.message;
            }
        });

        // Chat Logic
        showChatBtn.addEventListener('click', () => {
            chatSection.classList.remove('hidden');
            if (window.innerWidth < 768) chatSection.scrollIntoView({ behavior: 'smooth' });
        });
        closeChatBtn.addEventListener('click', () => chatSection.classList.add('hidden'));

        async function sendMessage() {
            const text = chatInput.value.trim();
            if (!text) return;

            addMessage(text, 'user');
            chatInput.value = '';

            const loadingId = addLoading();

            try {
                const res = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: text, context: generatedContent })
                });
                const data = await res.json();
                removeMessage(loadingId);
                addMessage(data.answer, 'ai');
            } catch (err) {
                removeMessage(loadingId);
                addMessage("Error connecting to AI.", 'ai');
            }
        }

        function addMessage(text, role) {
            const div = document.createElement('div');
            if (role === 'user') {
                div.className = 'bg-white/10 p-3 rounded-2xl rounded-tr-none ml-auto max-w-[80%] text-sm';
            } else {
                div.className = 'bg-indigo-500/10 p-3 rounded-2xl rounded-tl-none mr-auto max-w-[90%] text-sm border border-indigo-500/20';
            }
            div.textContent = text;
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addLoading() {
            const id = 'load-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = 'bg-indigo-500/10 p-3 rounded-2xl rounded-tl-none mr-auto text-xs text-white/50';
            div.textContent = 'Thinking...';
            chatMessages.appendChild(div);
            return id;
        }

        function removeMessage(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });

    </script>
</body>

</html>